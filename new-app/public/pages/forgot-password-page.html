<polymer-element name="forgot-password-page">
    <template>
        <style shim-shadowdom>
         *{
                margin: 0;
            }
            .page-header {
                display: block;
            }
            paper-input {
                width: 100%;
            }
            .form-content {
                height: 100%;
            }
             #footer {
              position: fixed;
              bottom: 0px;
             }
           
        </style>
         <core-header-panel mode="cover" class="page-header">
            <div id="logo"><img src="../images/app_icon_with_name.png"/></div>
        </core-header-panel>
        <div class="form-content" on-keypress="{{pressEnter}}">
            <section class="form">
                <h3 class="rs-title text-title" id="fg-title">Forgot Password?</h3>
                <p id="fg-instruction" class="fg-instruction text-caption">Enter your email that you used to sign-up Money Lover</p>
                <div class="content-form">
                    <paper-input name="fg-email" id="fg-email" floatingLabel label="Email" type="email"></paper-input>
                </div>
                <div class="button">
                    <paper-button class="button-flat-color" id="fg-go-login" label="Go to Login" on-click="{{gotoLogin}}" hidden></paper-button>
                    <paper-button class="button-flat-color" id="fg-confirm" label="Confirm" on-click="{{forgotConfirm}}"></paper-button>
                </div>
            </section>
            <div class="more-link">
                <a href="/login" id="fg-login-link">Login</a>
            </div>
        </div>
        <forgot-password-service id="forgotService"></forgot-password-service>
    
        <div id="footer">
            <ul>
                <li><a href="//moneylover.me" target="_blank">Money Lover</a></li>
                <li><a href="//moneylover.me/#money_lover_is_easy_to_get_started" target="_blank">Download</a></li>
                <li><a href="//moneylover.me/policy.html">Privacy Policy</a></li>
            </ul>
        </div>
    </template>

    <script>
        Polymer({
            domReady: function(){
                this.success = false;
            },

            forgotConfirm: function(){
                var email = this.$["fg-email"].value;
                var txtEmail = this.shadowRoot.querySelector("#fg-email");
                var instructionText = this.shadowRoot.querySelector("#fg-instruction");
                var btnConfirm = this.shadowRoot.querySelector("#fg-confirm");
                var btnLogin = this.shadowRoot.querySelector("#fg-go-login");
                var linkLogin = this.shadowRoot.querySelector("#fg-login-link");
                var title = this.shadowRoot.querySelector("#fg-title");

                if(email==="") {
                    txtEmail.setAttribute("invalid","true");
                    txtEmail.setAttribute("error","Please type your email");
                } else {
                    btnLogin.setAttribute("disabled","true");
                    txtEmail.setAttribute("disabled","true");
                    var that = this;
                    this.$['forgotService'].sendEmailForgot(email, function (data) {
                        if(data.error === 0){
                            that.success = true;

                            instructionText.innerHTML = "Please check your mail and follow the instruction";
                            instructionText.setAttribute("style","color:black;");
                            title.innerHTML = "Success!";
                            title.setAttribute("style","color:green;");
                            txtEmail.setAttribute("hidden","true");
                            btnConfirm.setAttribute("hidden","true");
                            btnLogin.removeAttribute("hidden");
                            btnLogin.removeAttribute("disabled");
                            linkLogin.setAttribute("hidden","true");
                        } else if(data.error === 1){
                            txtEmail.setAttribute("invalid","true");
                            txtEmail.setAttribute("error","Your email is not exist");
                            btnLogin.removeAttribute("disabled");
                            txtEmail.removeAttribute("disabled");
                        }
                    });
                }
            },

            gotoLogin: function(){
                goLoginPage();
            },

            pressEnter: function(event){
                if(!this.success) {
                    var btn = this.$['fg-confirm'];
                    if (event.keyCode === 13) {
                        console.log("Enter was pressed");
                        btn.focus();
                        this.forgotConfirm();
                    }
                }
            }
        });

        function goLoginPage(){
            window.location.href="/login";
        }

        //theming paper-input
        CoreStyle.g.paperInput.focusedColor = 'green';
    </script>
</polymer-element>