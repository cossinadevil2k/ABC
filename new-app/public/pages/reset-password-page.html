<polymer-element name="reset-password-page">
    <template>
        <style shim-shadowdom>
            * {
                margin: 0;
            }
            .page-header {
                display: block;
            }
            .form-content {
                height: 100%;
            }
            paper-input {
                width: 100%;
            }
            #footer {
              position: fixed;
              bottom: 0;
            }

            .form {
                padding-bottom: 2rem !important;
            }
        </style>

        <core-header-panel mode="cover" class="page-header">
            <div id="logo"><img src="../images/app_icon_with_name.png"/></div>
        </core-header-panel>
        <div class="content-form">
            <section class="form">
                <h3 class="rs-title text-title">Reset Password</h3>
                <div>
                    <p id="rs-instruction" class="fg-instruction text-caption">Enter your new password</p>
                    <div id="inputForm">
                        <div class="content-form">
                            <paper-input floatingLabel name="rs-password" id="rs-password" label="Password" type="password" ></paper-input>
                        </div>
                        <div class="content-form">
                            <paper-input floatingLabel name="rs-repassword" id="rs-repassword" label="Retype Password" type="password" ></paper-input>
                        </div>
                        <div class="button">
                            <paper-button id="rs-confirm" class="button-flat-color" label="Confirm" on-click="{{confirmReset}}"></paper-button>
                        </div>
                    </div>
                    
                </div>
            </section>
        </div>
        <div id="footer">
            <ul>
                <li><a href="//moneylover.me" target="_blank">Money Lover</a></li>
                <li><a href="//moneylover.me/#money_lover_is_easy_to_get_started" target="_blank">Download</a></li>
                <li><a href="//moneylover.me/policy.html">Privacy Policy</a></li>
            </ul>
        </div>

      <reset-password-service id="resetPwService"></reset-password-service>
    </template>
    <script>
        Polymer({
            domReady: function(){
                
            },
            confirmReset: function(){
                var password = this.$['rs-password'].value;
                var repassword = this.$['rs-repassword'].value;

                var txtPassword = this.shadowRoot.querySelector('#rs-password');
                var txtRepassword = this.shadowRoot.querySelector('#rs-repassword');
                var instruction = this.shadowRoot.querySelector("#rs-instruction");

                if(!password || password == "") {
                    txtPassword.setAttribute('invalid','true');
                    txtPassword.setAttribute('error','Please type your new password');
                }
                if(!repassword || repassword == ""){
                    txtRepassword.setAttribute('invalid','true');
                    txtRepassword.setAttribute('error','Please retype your new password');
                }
                if(repassword != password){
                    txtRepassword.setAttribute("invalid","true");
                    txtRepassword.setAttribute("error","Passwords must match");
                } else {
                    var that = this;
                    this.$['resetPwService'].resetConfirm(password, function(data){
                        if(data.error === 0){
                            //hide the inputForm
                            var inputForm = that.shadowRoot.querySelector('#inputForm');
                            inputForm.setAttribute('hidden','true');

                            instruction.setAttribute("style", "color: green;");
                            instruction.innerHTML = "Change password successfully.<br />Right now you can <a href='/login'>click here</a> to sign in using your new password"
                        }
                    })
                }
            }
        });

        //theming paper-input
        CoreStyle.g.paperInput.focusedColor = 'green';
    </script>
</polymer-element>