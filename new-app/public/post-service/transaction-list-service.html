

<polymer-element name="transaction-list-service" attributes="transactions">
    <template>
        <style>
            :host {
                display: none;
            }
        </style>
        <core-ajax id="ajax"
                   url="/api/transaction/list"
                   method="POST"
                   params='{"walletId":"{{walletId}}", "startDate":"{{startDate}}", "endDate":"{{endDate}}" }'
                   on-core-response="{{postsLoaded}}"
                   handleAs="json">
        </core-ajax>
    </template>
    <script>
        Polymer('transaction-list-service', {
            created: function() {
                this.transactions = [];
            },
            postsLoaded: function(event, response) {
                var status = response.xhr.status;
                if(status){
                    if(status===401){
                        this.fire('sessionExpired');
                    } else if (status===200){
                        var res = response.response;
                        if(res.error===0){
                            this.transactions = res.data.transactions;
                            this.callback({error: res.error, msg: res.msg});
                        } else if(res.error===401){
                            this.fire('sessionExpired');
                        } else {
                            this.callback(res);
                        }
                    }
                }
            },

            getTransaction: function(wallet, time, callback){
                this.callback = callback;

                if(wallet){
                    var startDate = moment(time).set('date', 1);
                    var endDate = moment(time).set('date', 1).add(1, 'month').subtract(1, 'day');

                    this.walletId = wallet._id;
                    this.startDate = this.databaseFormat(startDate);
                    this.endDate = this.databaseFormat(endDate);
                    this.$['ajax'].go();
                } else {
                    this.callback({error: 10, msg:"wallet_info_empty"});
                }
            },

            databaseFormat: function(date){
                return date.format('YYYY-MM-DD');
            },
        });
    </script>
</polymer-element>
